<div class="sidenav-overlay" [ngClass]="{'overlay-background' : isSidenavOpen, 'sidenav-overlay-top' : (isChatsWindowOpen || isFriendRequestsWindowOpen)}"
  *ngIf="isSidenavOpen || isDropMenuOpen || isShowSearchResults" (click)="OverlayClicked()"></div>
<div id="navbar">
  <div id="navbar-container">
    <div id="sidenav" class="sidenav" [ngClass]="{'sidenav-shadow' : isSidenavOpen}">
      <div class="sidenav-head-sector">
        <div class="sidenav-header">
          <profilePicture class="profile-picture" [isEditEnable]="true"></profilePicture>
          <div class="user-name" [title]="user.firstName + ' ' + user.lastName">{{user.firstName + " " + user.lastName}}</div>
          <div class="toolbar-menu">
            <span class="toolbar-item" *ngFor="let item of toolbarItems">
              <i [title]="item.title" (click)="item.onClick()" class="{{item.icon}}">{{item.innerIconText}}</i>
              <span class="badget-icon" (click)="item.onClick()" *ngIf="item.isShowToolbarItemBadget()"></span>
            </span>
          </div>
        </div>
      </div>
      <div class="sidenav-body-sector">
        <loaderSpinner id="friends-loader" class="friends-loader" *ngIf="isFriendsLoading"></loaderSpinner>
        <div id="friends-sector" class="friends-sector" *ngIf="!isFriendsLoading && friends.length > 0">
          <form class="form-horizontal" *ngIf="IsShowFriendFindInput() || friendSearchInput">
            <div class="form-group">
              <div id="friend-search-container" class="col-md-12">
                <i (click)="friendSearchInput=''" class="material-icons clear-friend-search">close</i>
                <input [(ngModel)]="friendSearchInput" style="padding-left:20px;" id="friend-search" name="friend-search" class="form-control"
                  type="text" placeholder="חיפוש חברים" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              </div>
            </div>
          </form>
          <div (click)="OpenChat(friend)" class="friend-container" *ngFor="let friend of (GetSidebarFriends(friendSearchInput))">
            <div class="friend-image-container">
              <div *ngIf="friend.isTyping" title="{{friend.firstName}} מקליד/ה" class="typing-icon">...</div>
              <div *ngIf="friend.isOnline" class="online-icon"></div>
              <img class="friend-profile" [src]="friend.profileImage || globalService.defaultProfileImage">
            </div>
            <span [ngClass]="{'bold-friend-name' : GetFriendUnreadMessagesNumberText(friend._id)}" class="friend-name-container" title="{{friend.firstName + ' ' + friend.lastName}}">
              <span>{{friend.firstName + " " + friend.lastName}}</span>
              <span>{{GetFriendUnreadMessagesNumberText(friend._id)}}</span>
            </span>
          </div>
        </div>
        <div style="position:relative;" *ngIf="!isFriendsLoading && friends.length == 0 && isSidenavOpen">
          <div class="new-friends-title">חברים חדשים</div>
          <div class="no-friends-container">
            <i (click)="SearchNewFriends()" class="material-icons no-friends-icon">people</i>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid navbar">
      <div class="col-xs-8 navbar-right-container">
        <img src="../logo/icon.png" class="head-icon" (click)="NavigateMain()">
        <span class="search-sector col-md-6 col-xs-10">
          <input type="text" id="search-input" class="search-input" placeholder="חיפוש" [(ngModel)]="searchInput" (ngModelChange)="SearchChange(searchInput)"
            (focus)="ClickSearchInput(searchInput)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
          <div *ngIf="isNewFriendsLabel && !isSidenavOpen && !isShowSearchResults">
            <span style="right:15px!important; color:#b2b2b2;" class="glyphicon glyphicon-triangle-top menu-top-arrow"></span>
            <div class="new-friends-label">חיפוש חברים חדשים</div>
          </div>
          <i class="material-icons search-icon" [ngClass]="{'search-icon-active':isShowSearchResults && GetFilteredSearchResults(searchInput).length > 0}">&#xE8B6;</i>
          <div class="search-results-container" *ngIf="isShowSearchResults && GetFilteredSearchResults(searchInput).length > 0">
            <div class="search-result" *ngFor="let result of GetFilteredSearchResults(searchInput)" [title]="result.fullName">
              <div class="result-details-container" (click)="OpenUserProfile(result)">
                <img *ngIf="result.profile && result.profile != -1" [src]="result.profile" class="search-result-image">
                <img *ngIf="!result.profile" [src]="globalService.defaultProfileImage" class="search-result-image">
                <span *ngIf="result.profile == -1" class="search-result-image-loading">
                  <loaderDots></loaderDots>
                </span>
                <span class="search-result-name">{{result.fullName}}</span>
              </div>
              <div *ngIf="IsShowAddFriendRequestBtn(result._id) ||
                IsShowRemoveFriendRequestBtn(result._id) ||
                IsShowFriendRequestConfirmSector(result._id)" class="result-friend-request-btns-container">
                <i *ngIf="IsShowAddFriendRequestBtn(result._id)" (click)="AddFriendRequest(result._id)" class="fa fa-user-plus friend-request-btn"
                  title="בקשת חברות" aria-hidden="true"></i>
                <i *ngIf="IsShowRemoveFriendRequestBtn(result._id)" (click)="RemoveFriendRequest(result._id)" class="fa fa-user-times friend-request-btn remove-request"
                  title="ביטול בקשת חברות" aria-hidden="true"></i>
                <span *ngIf="IsShowFriendRequestConfirmSector(result._id)">
                  <i class="fa fa-user-plus friend-request-confirm-icon" title="אישור בקשת חברות" aria-hidden="true"></i>
                  <i (click)="AddFriend(result._id)" class="material-icons friend-request-confirm-btn" title="אישור">check</i>
                  <i (click)="IgnoreFriendRequest(result._id)" class="material-icons friend-request-decline-btn" title="ביטול">close</i>
                </span>
              </div>
            </div>
          </div>
        </span>
      </div>
      <div style="float:left;" class="col-xs-4">
        <div *ngIf="user" class="manage-sector">
          <span (click)="ShowHideDropMenu()" class="glyphicon glyphicon-triangle-bottom menu-icon"></span>
          <span (click)="ShowHideDropMenu()" class="name">
            <span class="top-navbar-user-image">
              <profilePicture [isEditEnable]="false"></profilePicture>
            </span> {{user.firstName}}
          </span>
          <span *ngIf="isDropMenuOpen">
            <span class="glyphicon glyphicon-triangle-top menu-top-arrow"></span>
            <dropMenu class="dropMenuPosition col-md-2 col-xs-4" [options]="dropMenuDataList"></dropMenu>
          </span>
        </div>
      </div>
    </div>
  </div>
  <span (click)="MessageNotificationClicked()" id="notification" class="notification" *ngIf="isShowMessageNotification && !isShowFriendRequestNotification">
    <span class="notification-name">{{messageNotificationName}}</span>:
    <span *ngIf="!isMessageNotificationImage" class="notification-text">{{messageNotificationText}}</span>
    <span *ngIf="isMessageNotificationImage" class="notification-text">שלח/ה לך תמונה</span>
  </span>
  <span id="notification" class="notification" *ngIf="(isShowFriendRequestNotification || isShowFriendConfirmNotification) && !isShowMessageNotification">
    <span class="notification-name">{{friendRequestNotificationName}}</span>
    <span *ngIf="isShowFriendRequestNotification" class="notification-text">שלח/ה לך בקשת חברות</span>
    <span *ngIf="isShowFriendConfirmNotification" class="notification-text">אישר/ה את בקשת החברות</span>
  </span>

  <div id="open-sidenav-btn" class="open-sidenav-btn" [ngClass]="{'open-sidenav' : isSidenavOpen}" (click)="ShowHideSidenav()">
    <div class="notifications-budget" *ngIf="!isHideNotificationsBudget && GetNotificationsNumber() > 0">
      <span class="notifications-number">{{GetNotificationsNumber()}}</span>
    </div>
    <i class="material-icons open-sidenav-icon">{{isSidenavOpen ? '&#xE315;': '&#xE314;'}}</i>
  </div>
</div>

<profile *ngIf="isOpenProfileEditWindow"></profile>
<chatsWindow [hidden]="!isChatsWindowOpen" [OpenChat]="OpenChat.bind(this)" [messagesNotifications]="GetToolbarItem('messages').content"></chatsWindow>
<friendRequestsWindow [hidden]="!isFriendRequestsWindowOpen" [isFriendRequestsWindowOpen]="isFriendRequestsWindowOpen" [AddFriend]="AddFriend.bind(this)"
  [IgnoreFriendRequest]="IgnoreFriendRequest.bind(this)" [friendRequests]="GetToolbarItem('friendRequests').content.get" [confirmedReuests]="GetToolbarItem('friendRequests').content.accept"></friendRequestsWindow>
<chat *ngIf="chatData.isOpen" [chatData]="chatData" [GetFriendById]="GetFriendById.bind(this)" [OpenChat]="OpenChat.bind(this)"></chat>